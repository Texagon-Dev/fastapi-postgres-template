# FastAPI Postgres Template

This is a template project for a FastAPI application with a PostgreSQL database, pgAdmin for database management, and Traefik as a reverse proxy. All services are containerized using Docker.

## Prerequisites

*   Docker and Docker Compose installed.
*   A code editor (e.g., VS Code).
*   A terminal or command prompt.

## Basic Configuration

1.  **Environment Variables**:
    This project uses a `.env` file for local development configuration. If it doesn't exist, create one in the project root by copying `.env.example` (if you have one) or by creating it manually.
    Key variables to check/set in your `.env` file (though many are also set directly in `docker-compose.yml` for Dockerized environment):


    ```
    cp .env.example .env
    ```
    **Note**: For the Docker setup, database connection details (`DATABASE_URL`, `DATABASE_USER`, `DATABASE_PASSWORD`, etc.) are primarily sourced from the `environment` section of the `fastapi` and `db` services in the `docker-compose.yml` file. The `DATABASE_URL` in `.env` might be used if your application reads it directly for other purposes or for local non-Docker development.


## Docker Build and Run

To build and start all the services (FastAPI application, PostgreSQL database, pgAdmin, and Traefik):

```bash
docker compose up --build -d
```

*   `--build`: Forces Docker to rebuild the images if there are changes (e.g., in your `Dockerfile` or application code).
*   `-d`: Runs the containers in detached mode (in the background).

To stop the services:

```bash
docker compose down
```

To stop and remove volumes (useful for a clean restart, **will delete database data**):

```bash
docker compose down -v
```

To view logs for all services:
```bash
docker compose logs -f
```
To view logs for a specific service (e.g., `fastapi`):
```bash
docker compose logs -f fastapi
```

## Accessing Services

Once the containers are running:

*   **Backend API (FastAPI)**:
    *   Via Traefik: `http://api.localhost`
    *   Directly (if Traefik is not used or for direct port access): `http://localhost:8000`
    *   API Docs (Swagger UI): `http://api.localhost/docs` or `http://localhost:8000/docs`
    *   Alternative API Docs (ReDoc): `http://api.localhost/redoc` or `http://localhost:8000/redoc`

*   **pgAdmin (Database Management)**:
    *   Via Traefik: `http://pgadmin.localhost`
    *   Directly: `http://localhost:5050`
    *   **Login Credentials** (defined in `docker-compose.yml`):
        *   Email: `admin@admin.com`
        *   Password: `admin`

*   **Traefik Dashboard** (for inspecting routes and services):
    *   `http://localhost:8080`

## pgAdmin: Connecting to the PostgreSQL Database

After logging into pgAdmin, you'll need to register your PostgreSQL server (the `db` service from `docker-compose.yml`):

1.  In the pgAdmin browser tree (left panel), right-click on **Servers**.
2.  Select **Register** -> **Server...**.
3.  In the **General** tab:
    *   **Name**: Enter a descriptive name for your server (e.g., `Local Docker DB`, `fastapi_db_service`).
4.  Switch to the **Connection** tab:
    *   **Host name/address**: `db` (This is the service name of your PostgreSQL container in `docker-compose.yml`).
    *   **Port**: `5432` (Default PostgreSQL port).
    *   **Maintenance database**: `fastapi_db` (This is the `POSTGRES_DB` value from your `db` service environment).
    *   **Username**: `hbky` (This is the `POSTGRES_USER` value).
    *   **Password**: `password` (This is the `POSTGRES_PASSWORD` value).
    *   You can leave other settings as default or adjust as needed.
5.  Click **Save**.

Your database server should now appear in the list, and you can browse its contents, run queries, etc.

## Project Structure (Brief Overview)

```
├── app/                  # Main application code
│   ├── __init__.py
│   ├── main.py           # FastAPI application entry point and setup
│   ├── alembic/          # Alembic database migration scripts
│   │   ├── env.py
│   │   ├── README
│   │   ├── script.py.mako
│   │   └── versions/     # Individual migration files
│   ├── commands/         # Custom management commands
│   │   ├── __init__.py
│   │   └── create_admin.py # Script to create a superuser
│   ├── features/         # Feature-specific modules (e.g., authentication)
│   │   ├── __init__.py
│   │   └── auth/         # Authentication related logic, routes
│   ├── graphql/          # GraphQL specific code
│   │   ├── __init__.py
│   │   ├── context.py    # GraphQL context setup
│   │   └── schema.py     # GraphQL schema definition
│   ├── models/           # SQLAlchemy database models
│   │   ├── __init__.py
│   │   └── user.py       # User model definition
│   ├── services/         # Global services
│   │   └── email_service.py
│   ├── templates/        # HTML templates (e.g., for emails)
│   │   └── emails/
│   └── utils/            # Utility functions and helpers
│       ├── __init__.py
│       ├── api.py        # API related utilities (e.g., route registration)
│       ├── config.py     # Application configuration settings
│       ├── database.py   # Database connection and session management
│       ├── dependencies.py # FastAPI dependency injectors
│       ├── exception_handler.py # Custom exception handlers
│       ├── helpers.py    # General helper functions
│       ├── logging.py    # Logging configuration
│       ├── permissions.py # Permission checking logic
│       ├── rate_limiter.py # API rate limiting setup
│       └── security.py   # Security-related functions (e.g., password hashing)
├── tests/                # Unit and integration tests (conventionally placed here)
├── .env                  # Local environment variables (you need to create this)
├── .gitignore            # Specifies intentionally untracked files that Git should ignore
├── alembic.ini           # Alembic configuration file
├── docker-compose.yml    # Docker Compose configuration for all services
├── Dockerfile            # Dockerfile for building the FastAPI application image
├── entrypoint.sh         # Entrypoint script for the FastAPI container
├── init.sql              # SQL script for initial database setup (e.g., creating roles/db)
├── pyproject.toml        # Project metadata and dependencies (for tools like Poetry or uv)
├── README.md             # This file
└── uv.lock               # Lock file for dependencies managed by uv (if using uv)
```


## Further Development

*   Add features in `app/features/`.
*   Update database models in `app/models/`
*   Run database migrations using Alembic if you change your models:
    ```bash
    # Inside the fastapi container or with docker compose exec
    docker compose exec fastapi alembic revision -m "your_migration_message"
    docker compose exec fastapi alembic upgrade head
    ```

Happy coding!